#Evaluating the impact of sampling bias on the measurement of the ecological niche
#The aim of this thesis  is to propose a method that shows how subsampling due to roadside bias affects niche completeness.


#install all the packages 

install.packages("CAST")
install.packages("caret")
install.packages("sf")
install.packages("ClimDatDownloadR")
install.packages("devtools")
install.packages("raster")
install.packages("viridis")
install.packages("virtualspecies")
install.packages("ggplot2")
install.packages("tidyverse")
install.packages("terra")
install.packages("ade4")
install.packages("hypervolume")
install.packages("gdata")
install.packages("ggmap")
install.packages("osmdata")
install.packages("osmextract")

# load packages
library(CAST)
library(caret)
library(sf)
library(ClimDatDownloadR)
library(devtools)
library(raster)
library(viridis)
library(virtualspecies)
library(ggplot2)
library(tidyverse)
library(terra)
library(ade4)
library(hypervolume)
library(gdata)
library(ggmap)
library(osmdata)
library(osmextract)

# set working directory
setwd("C:/tesi")



# ============================
# Regione Sicilia
# ============================

# upload shapefile
aoi_sicilia <- st_read("Sicilia.shp")

# bounding box 
aoi_bb_sicilia <- st_bbox(aoi_sicilia)

# from Open Street Map select type of roads: primary, secondary, tertiary (paths)
ht_secondary <- "secondary"

# download roads from OSM: our region now is Sicilia, Italy
osm_aoi_sicilia <- oe_get("Sicilia", stringsAsFactors = FALSE, quiet = TRUE)
osm_aoi_roads_sicilia <- osm_aoi_sicilia[osm_aoi_sicilia$highway %in% ht_secondary, ]
plot(osm_aoi_roads_sicilia$geometry)


##  Download bioclimatic variables from CHELSA
#The bioclimatic variables chosen are: 
#Average annual temperature
#Annual temperature range
#Annual precipitation
#July precipitation


# Set path where the TIF files are saved
tif_path <- "C:/tesi/bio/ChelsaV2.1Climatologies"

# List of raster files (matching the names for specific bioclimatic variables)
rastlist <- list.files(path = tif_path, 
                       pattern = "CHELSA_bio_(01|07|13|14)_1981-2010_V2.1", 
                       full.names = TRUE)

# Import the TIF files into a single raster stack
mydata <- stack(rastlist)

# Change data names to match the desired variable names
names(mydata) <- c("bio01", "bio07", "bio13", "bio14")

# Convert the AOI (area of interest) to a spatial object
aoi_sp <- sf::as_Spatial(aoi_sicilia)

# Crop and mask the raster stack using the Sicily AOI
mydata_sicilia <- mydata %>% crop(., aoi_sp) %>% mask(., aoi_sp)

# Backup the original raster stack for later use
mydata_sicilia_backup <- mydata_sicilia



## View bioclimatic variables
# Plot for the variable bio01 (Annual mean temperature)
plot(mydata_sicilia$bio01, main = "Bio01 - Annual Mean Temperature", col = viridis::viridis(100))

# Plot for the variable bio07 (Annual temperature range)
plot(mydata_sicilia$bio07, main = "Bio07 - Annual Temperature Range", col = viridis::viridis(100))

# Plot for the variable bio13 (Annual precipitation)
plot(mydata_sicilia$bio13, main = "Bio13 - Annual Precipitation", col = viridis::viridis(100))

# Plot for the variable bio14 (Precipitation of July)
plot(mydata_sicilia$bio14, main = "Bio14 - Precipitation of July", col = viridis::viridis(100))


